# `code_merger.py` 파일 분석

## 1. 파일의 핵심 역할

이 파일은 지정된 디렉토리 내에 있는 특정 확장자(`.py`, `.sh`)의 파일들을 **하나의 문자열로 병합**하는 실질적인 로직을 담당합니다.

- **해결하려는 문제**: 여러 파일에 흩어져 있는 코드를 단일 텍스트로 모아 전체적인 코드의 양을 파악하거나, LLM(거대 언어 모델)에 컨텍스트로 제공하는 등의 후속 작업을 용이하게 만듭니다. 사용자가 수동으로 파일을 열어 복사/붙여넣기 해야 하는 번거로움을 해결합니다.

## 2. 주요 구성 요소

### 가. 상수 정의

- `MAX_FILE_SIZE`: 단일 파일의 최대 허용 크기를 1MB로 제한합니다. 너무 큰 파일(예: base64 인코딩된 데이터) 하나 때문에 전체 프로세스가 과도한 메모리를 사용하는 것을 방지합니다.
- `MAX_TOTAL_SIZE`: 병합될 전체 결과물의 최대 크기를 10MB로 제한합니다. 이 또한 시스템의 안정성을 위한 중요한 안전장치입니다.

### 나. 핵심 함수

- `merge_files(path: str, extension: str) -> str`: 이 파일의 핵심 로직을 담고 있는 범용 함수입니다.
    - **파일 탐색**: `os.walk`를 사용하여 지정된 `path`를 재귀적으로 탐색합니다. 이때 `dirnames[:] = [d for d in dirnames if d not in EXCLUDE_DIRS]` 구문을 통해 `constants.py`에 정의된 제외 폴더(`venv`, `.git` 등)는 아예 탐색하지 않아 성능을 향상시킵니다.
    - **파일 필터링 및 병합**: 탐색된 파일 중 주어진 `extension`으로 끝나는 파일만 선택하여, 각 파일의 내용을 순서대로 읽어 `output`(StringIO)에 추가합니다. 파일 내용 앞에는 `# === File: {상대경로} ===` 형태의 헤더를 붙여 파일 간의 구분을 명확히 합니다.
    - **오류 및 예외 처리**: 파일 크기 제한을 초과하는 파일은 건너뛰고, 그 외 파일 읽기 등에서 발생하는 오류는 `failed_files` 리스트에 기록합니다. 프로세스가 중단되지 않고 끝까지 실행되도록 합니다.
    - **결과 요약**: 모든 작업이 끝난 후, 병합된 파일 수, 총 크기, 건너뛴 파일 수, 실패한 파일 목록 등을 포함한 요약 정보를 결과물 최상단에 추가하여 사용자에게 제공합니다.

- `merge_python_files(path: str)` 및 `merge_shell_files(path: str)`: `merge_files` 함수를 특정 확장자(`.py`, `.sh`)에 대해 쉽게 사용할 수 있도록 제공하는 래퍼(Wrapper) 함수입니다.

## 3. 다른 파일과의 연관성

- **`backend/app/main.py`**: 이 파일의 `merge_python_files`와 `merge_shell_files` 함수를 직접 호출하여 코드 병합 기능을 실행합니다.
- **`backend/app/utils/constants.py`**: 파일 탐색 시 제외할 폴더 목록이 정의된 `EXCLUDE_DIRS` 상수를 `import`하여 사용합니다.

## 4. 종합 평가

`code_merger.py`는 파일 병합이라는 명확한 단일 책임을 잘 수행하고 있는 모듈입니다. 특히 `os.walk`를 활용한 효율적인 파일 탐색, 메모리 문제를 방지하기 위한 용량 제한 설정, 그리고 어떤 파일이 왜 처리되지 않았는지 알려주는 상세한 요약 정보 기능은 이 모듈을 매우 안정적이고 사용자 친화적으로 만듭니다.