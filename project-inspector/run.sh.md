# `run.sh` 파일 분석

## 1. 파일의 핵심 역할

이 파일은 **개발 환경을 한번에 실행시켜주는 개발자용 편의 스크립트**입니다. 백엔드 서버와 프론트엔드 개발 서버를 각각 다른 터미널에서 실행해야 하는 번거로움을 없애고, 단 하나의 명령어로 전체 애플리케이션을 구동할 수 있게 해줍니다.

- **해결하려는 문제**: 개발자가 프로젝트를 시작할 때마다 여러 개의 터미널을 열고, 각 서버를 실행하는 반복적이고 번거로운 작업을 자동화합니다. 또한, 서버를 종료할 때 관련 프로세스가 좀비처럼 남아있는 문제를 방지합니다.

## 2. 주요 구성 요소

스크립트는 위에서부터 아래로 순차적으로 실행되며, 각 단계는 명확한 목적을 가집니다.

### 가. 기존 프로세스 정리

```bash
if lsof -Pi :8000 -sTCP:LISTEN -t >/dev/null ; then
    echo "Killing process on port 8000..."
    kill -9 $(lsof -t -i:8000) 2>/dev/null
fi
# ... (5173 포트에 대해서도 동일하게 실행)
```
- **역할**: 스크립트를 실행했을 때, 이전에 비정상적으로 종료되었거나 이미 실행 중인 서버가 사용하는 포트(8000, 5173)를 미리 정리합니다.
- **동작**: `lsof` 명령어를 사용해 특정 포트를 점유하고 있는 프로세스의 ID(PID)를 찾고, `kill -9` 명령어로 해당 프로세스를 강제 종료합니다. 이를 통해 "Address already in use" (이미 사용 중인 주소) 에러를 방지합니다.

### 나. 백엔드 및 프론트엔드 서버 실행

```bash
# 백엔드 서버 실행
echo "Starting backend server..."
cd backend
source ../venv/bin/activate
uvicorn app.main:app --reload &
BACKEND_PID=$!

# 프론트엔드 서버 실행
echo "Starting frontend server..."
cd ../frontend
npm run dev -- --port 5173 &
FRONTEND_PID=$!
```
- **역할**: 백엔드와 프론트엔드 서버를 각각 실행합니다.
- **동작**:
    1. `cd` 명령어로 각 서버의 디렉토리로 이동합니다.
    2. 백엔드의 경우, `source` 명령어로 Python 가상환경을 활성화합니다.
    3. `uvicorn ... &` 및 `npm run dev ... &` 처럼 명령어 끝에 `&`를 붙여 각 서버를 **백그라운드 프로세스**로 실행합니다. 이렇게 해야 스크립트가 다음 명령어를 계속 실행할 수 있습니다.
    4. `$!`는 바로 이전에 실행된 백그라운드 프로세스의 PID를 의미합니다. 이 값을 `BACKEND_PID`, `FRONTEND_PID` 변수에 저장해두어 나중에 종료 시 사용할 수 있도록 합니다.

### 다. 종료 처리 (Graceful Shutdown)

```bash
trap "echo 'Stopping servers...'; kill $BACKEND_PID $FRONTEND_PID; exit" INT

wait
```
- **역할**: 사용자가 `Ctrl+C` (SIGINT 신호)를 눌러 스크립트를 종료할 때, 백그라운드에서 실행 중인 백엔드와 프론트엔드 서버도 함께 깔끔하게 종료되도록 합니다.
- **동작**:
    1. `trap` 명령어는 특정 신호(여기서는 `INT`)를 받았을 때 실행할 명령어를 미리 지정하는 역할을 합니다. `Ctrl+C`가 눌리면, `'Stopping servers...'` 메시지를 출력하고, 이전에 저장해둔 PID를 이용해 `kill` 명령어로 두 서버 프로세스를 종료시킨 후 스크립트 자신도 종료(`exit`)합니다.
    2. `wait` 명령어는 백그라운드 프로세스들이 종료될 때까지 스크립트가 끝나지 않고 기다리는 역할을 합니다. 이 명령어가 없으면 스크립트는 서버 실행 후 바로 종료되어 버립니다.

## 3. 다른 파일과의 연관성

- 이 스크립트는 프로젝트의 다른 어떤 파일과도 직접적인 코드 레벨의 연관성은 없습니다. 대신, 운영체제의 셸 환경에서 **다른 파일들을 실행시켜주는 역할**을 합니다.

## 4. 종합 평가

`run.sh`는 작지만 매우 실용적인 스크립트입니다. 개발 생산성을 크게 향상시켜주며, 특히 `trap`을 이용한 종료 처리는 개발 편의성을 고려한 좋은 설계입니다. 이 스크립트 하나만으로도 프로젝트의 개발 환경 설정과 정리에 대한 고민이 잘 담겨있음을 알 수 있습니다.
