# ì‹¤ì „ ê°œë°œ í”„ë¡œì„¸ìŠ¤ í•™ìŠµ ê°€ì´ë“œ

> StoreBridge í”„ë¡œì íŠ¸ë¥¼ í†µí•´ ë°°ìš°ëŠ” **ì‹¤ë¬´ ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œ ë°©ë²•ë¡ **

**ì‘ì„±ì¼**: 2025-10-16
**ëŒ€ìƒ**: ì£¼ë‹ˆì–´~ë¯¸ë“œ ê°œë°œì, ì‹¤ë¬´ í”„ë¡œì„¸ìŠ¤ í•™ìŠµì

---

## ğŸ“‹ ëª©ì°¨

1. [ê°œìš”: ì™œ ì´ ê³¼ì •ì´ ì¤‘ìš”í•œê°€?](#ê°œìš”-ì™œ-ì´-ê³¼ì •ì´-ì¤‘ìš”í•œê°€)
2. [Phase 0: ìš”êµ¬ì‚¬í•­ ë¶„ì„ & ê¸°ìˆ  ì¡°ì‚¬](#phase-0-ìš”êµ¬ì‚¬í•­-ë¶„ì„--ê¸°ìˆ -ì¡°ì‚¬)
3. [Phase 1: ì•„í‚¤í…ì²˜ ì„¤ê³„](#phase-1-ì•„í‚¤í…ì²˜-ì„¤ê³„)
4. [Phase 2: í”„ë¡œí† íƒ€ì… & ìŠ¤íŒŒì´í¬](#phase-2-í”„ë¡œí† íƒ€ì…--ìŠ¤íŒŒì´í¬)
5. [Phase 3: ë°˜ë³µ ê°œë°œ (Iterative Development)](#phase-3-ë°˜ë³µ-ê°œë°œ-iterative-development)
6. [Phase 4: í…ŒìŠ¤íŠ¸ & í’ˆì§ˆ ê´€ë¦¬](#phase-4-í…ŒìŠ¤íŠ¸--í’ˆì§ˆ-ê´€ë¦¬)
7. [Phase 5: ë°°í¬ & ìš´ì˜](#phase-5-ë°°í¬--ìš´ì˜)
8. [ì‹¤ì „ íŒ & ì•ˆí‹°íŒ¨í„´](#ì‹¤ì „-íŒ--ì•ˆí‹°íŒ¨í„´)
9. [í•™ìŠµ ì²´í¬ë¦¬ìŠ¤íŠ¸](#í•™ìŠµ-ì²´í¬ë¦¬ìŠ¤íŠ¸)

---

## ê°œìš”: ì™œ ì´ ê³¼ì •ì´ ì¤‘ìš”í•œê°€?

### âŒ ì´ˆë³´ìê°€ í”íˆ í•˜ëŠ” ì‹¤ìˆ˜

```
ìš”êµ¬ì‚¬í•­ ë“£ìë§ˆì â†’ ë°”ë¡œ ì½”ë”© ì‹œì‘ â†’ ì¤‘ê°„ì— ë§‰í˜ â†’ ì²˜ìŒë¶€í„° ë‹¤ì‹œ
```

**ë¬¸ì œì :**
- ì „ì²´ êµ¬ì¡° íŒŒì•… ì—†ì´ ì‹œì‘ â†’ ë‚˜ì¤‘ì— ë¦¬íŒ©í† ë§ ì§€ì˜¥
- API ì œì•½ ì‚¬í•­ ëª¨ë¦„ â†’ ì¤‘ê°„ì— ë°©í–¥ ì „í™˜
- ì—ëŸ¬ ì¼€ì´ìŠ¤ ê³ ë ¤ ì•ˆ í•¨ â†’ ì‹¤ì „ íˆ¬ì… ì‹œ ì¥ì• 
- í™•ì¥ì„± ì—†ìŒ â†’ ê¸°ëŠ¥ ì¶”ê°€í•  ë•Œë§ˆë‹¤ ì „ì²´ ìˆ˜ì •

---

### âœ… ì˜¬ë°”ë¥¸ í”„ë¡œì„¸ìŠ¤

```
ìš”êµ¬ì‚¬í•­ ë¶„ì„ â†’ ê¸°ìˆ  ì¡°ì‚¬ â†’ ì•„í‚¤í…ì²˜ ì„¤ê³„ â†’
í”„ë¡œí† íƒ€ì… â†’ ë°˜ë³µ ê°œë°œ â†’ í…ŒìŠ¤íŠ¸ â†’ ë°°í¬ â†’ ìš´ì˜/ëª¨ë‹ˆí„°ë§
```

**ì¥ì :**
- ğŸ¯ **ëª…í™•í•œ ëª©í‘œ**: ì–´ë””ë¡œ ê°€ëŠ”ì§€ ì•Œê³  ì‹œì‘
- â±ï¸ **ì‹œê°„ ì ˆì•½**: ë‚˜ì¤‘ì— ë’¤ì§‘ì„ ì¼ì´ ì¤„ì–´ë“¦
- ğŸ›¡ï¸ **ë¦¬ìŠ¤í¬ ê´€ë¦¬**: ë¯¸ë¦¬ ì¥ì•  ìš”ì¸ ì œê±°
- ğŸ“ˆ **í™•ì¥ ê°€ëŠ¥**: ê¸°ëŠ¥ ì¶”ê°€ê°€ ì‰¬ì›€
- ğŸ¤ **í˜‘ì—… ìš©ì´**: íŒ€ì›ì´ ì´í•´í•˜ê¸° ì‰¬ì›€

---

## Phase 0: ìš”êµ¬ì‚¬í•­ ë¶„ì„ & ê¸°ìˆ  ì¡°ì‚¬

### 0-1. ìš”êµ¬ì‚¬í•­ ëª…í™•í™”

#### â“ **ì§ˆë¬¸ìœ¼ë¡œ ì‹œì‘í•˜ê¸°**

ì´ˆê¸° ìš”êµ¬ì‚¬í•­:
> "ë„ë§¤ê¾¹ ìƒí’ˆì„ ë„¤ì´ë²„ ìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´ì— ìë™ ë“±ë¡í•´ì¤˜"

**ëª…í™•í™” ì§ˆë¬¸ ëª©ë¡:**
```
1. ê¸°ëŠ¥ ë²”ìœ„
   - ìƒí’ˆ ë“±ë¡ë§Œ? ìˆ˜ì •/ì‚­ì œë„?
   - ì¬ê³ /ê°€ê²© ë™ê¸°í™” í•„ìš”?
   - ì£¼ë¬¸ ì—°ë™ê¹Œì§€?

2. ë°ì´í„° ë³¼ë¥¨
   - ëª‡ ê°œë‚˜ ë“±ë¡? (100ê°œ? 10,000ê°œ?)
   - í•˜ë£¨ì— ëª‡ ë²ˆ? (1íšŒ? ê³„ì†?)

3. ì œì•½ ì‚¬í•­
   - API í‚¤ ìˆì–´? ë°œê¸‰ ë°©ë²•ì€?
   - Rate Limitì€?
   - ë¹„ìš© ì˜ˆì‚°ì€?

4. ì„±ê³µ ê¸°ì¤€
   - ë“±ë¡ ì„±ê³µë¥  ëª©í‘œ? (100%? 80%?)
   - ë°˜ë ¤ë˜ë©´ ì–´ë–»ê²Œ? (ìˆ˜ë™ ì²˜ë¦¬? ìë™ ì¬ì‹œë„?)
   - ì†ë„ëŠ”? (10ì´ˆ/ê°œ? 1ë¶„/ê°œ?)

5. ìš´ì˜
   - ëˆ„ê°€ ì‚¬ìš©? (ê°œë°œì? ë¹„ê°œë°œì?)
   - ëª¨ë‹ˆí„°ë§ í•„ìš”? (ëŒ€ì‹œë³´ë“œ? ì•Œë¦¼?)
   - ì¥ì•  ì‹œ ëŒ€ì‘ ì ˆì°¨ëŠ”?
```

#### ğŸ“ **ìš”êµ¬ì‚¬í•­ ë¬¸ì„œ ì‘ì„±**

```markdown
# StoreBridge ìš”êµ¬ì‚¬í•­ ëª…ì„¸ì„œ (PRD - Product Requirements Document)

## 1. ë¹„ì¦ˆë‹ˆìŠ¤ ëª©í‘œ
- ë„ë§¤ê¾¹ ìƒí’ˆì„ ë„¤ì´ë²„ ìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´ì— ìë™ ë“±ë¡í•˜ì—¬ ìˆ˜ë™ ì‘ì—… ì‹œê°„ 90% ì ˆê°
- í•˜ë£¨ 5,000ê°œ ìƒí’ˆ ë“±ë¡ ì§€ì›

## 2. ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­ (Functional Requirements)
- [FR-01] ë„ë§¤ê¾¹ ìƒí’ˆ ê²€ìƒ‰/ì¹´í…Œê³ ë¦¬ ê¸°ë°˜ ìˆ˜ì§‘
- [FR-02] ìƒí’ˆ ì •ë³´ ì •ê·œí™” (ì´ë¯¸ì§€, ì˜µì…˜, ê°€ê²©)
- [FR-03] ë„¤ì´ë²„ ìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´ ìë™ ë“±ë¡
- [FR-04] ë°˜ë ¤ ìƒí’ˆ ìˆ˜ë™ ê²€í†  í
- [FR-05] ê°€ê²©/ì¬ê³  ë™ê¸°í™” (ì„ íƒ)

## 3. ë¹„ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­ (Non-Functional Requirements)
- [NFR-01] ë“±ë¡ ì„±ê³µë¥  85% ì´ìƒ
- [NFR-02] í‰ê·  ì²˜ë¦¬ ì‹œê°„ 30ì´ˆ/ìƒí’ˆ ì´í•˜
- [NFR-03] API Rate Limit ì¤€ìˆ˜ (ë„ë§¤ê¾¹ 180/ë¶„, ë„¤ì´ë²„ 2/ì´ˆ)
- [NFR-04] 24/7 ë¬´ì¤‘ë‹¨ ìš´ì˜
- [NFR-05] ì—ëŸ¬ ë°œìƒ ì‹œ 5ë¶„ ì´ë‚´ ì•Œë¦¼

## 4. ì œì•½ ì‚¬í•­ (Constraints)
- ë„ë§¤ê¾¹ API: EUC-KR ì¸ì½”ë”©, 15K í˜¸ì¶œ/ì¼
- ë„¤ì´ë²„ API: OAuth 2.0, IP í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸, ì´ˆë‹¹ 2íšŒ
- ì˜ˆì‚°: ì›” $100 ì´í•˜ (AWS/GCP ê¸°ì¤€)

## 5. ë²”ìœ„ ì™¸ (Out of Scope)
- ì£¼ë¬¸ ìë™ ì²˜ë¦¬
- ê³ ê° ë¬¸ì˜ ìë™ ì‘ë‹µ
- ê²½ìŸì‚¬ ê°€ê²© ë¶„ì„
```

---

### 0-2. ê¸°ìˆ  ì¡°ì‚¬ (Tech Spike)

#### ğŸ” **ì¡°ì‚¬í•´ì•¼ í•  í•­ëª©**

```
1. ì™¸ë¶€ API
   âœ… ë„ë§¤ê¾¹ API ë¬¸ì„œ ì½ê¸°
   âœ… ë„¤ì´ë²„ ì»¤ë¨¸ìŠ¤ API ë¬¸ì„œ ì½ê¸°
   âœ… ì‹¤ì œ í˜¸ì¶œ í…ŒìŠ¤íŠ¸ (Postman/curl)
   âœ… Rate Limit í™•ì¸
   âœ… ì—ëŸ¬ ì½”ë“œ ëª©ë¡ í™•ì¸

2. ê¸°ìˆ  ìŠ¤íƒ í›„ë³´
   âœ… ì–¸ì–´: Python vs Node.js vs Go
   âœ… í: Celery vs BullMQ vs AWS SQS
   âœ… DB: PostgreSQL vs MongoDB
   âœ… ìºì‹œ: Redis vs Memcached

3. ìœ ì‚¬ ì‚¬ë¡€ ì¡°ì‚¬
   âœ… GitHubì—ì„œ "ìƒí’ˆ ë“±ë¡ ìë™í™”" ê²€ìƒ‰
   âœ… ê¸°ìˆ  ë¸”ë¡œê·¸ ì½ê¸°
   âœ… Stack Overflow ì§ˆë¬¸ í™•ì¸

4. ë¦¬ìŠ¤í¬ ì‹ë³„
   âš ï¸ ë„¤ì´ë²„ API 2 TPS ì œì•½ â†’ ë³‘ëª© ê°€ëŠ¥ì„±
   âš ï¸ ì˜µì…˜ êµ¬ì¡° ì°¨ì´ â†’ ë³€í™˜ ë³µì¡ë„ ë†’ìŒ
   âš ï¸ ê¸ˆì§€ì–´ ìë™ ê²€ì¶œ â†’ ë°˜ë ¤ìœ¨ ì˜ˆì¸¡ ì–´ë ¤ì›€
```

#### ğŸ“Š **ê¸°ìˆ  ì¡°ì‚¬ ê²°ê³¼ ë¬¸ì„œ**

```markdown
# API ì¡°ì‚¬ ê²°ê³¼

## ë„ë§¤ê¾¹ OpenAPI
- âœ… ê³µì‹ API ì¡´ì¬
- âš ï¸ EUC-KR ì¸ì½”ë”© í•„ìˆ˜ (í•œê¸€ ì²˜ë¦¬ ì£¼ì˜)
- âš ï¸ Rate Limit: 180/ë¶„, 15K/ì¼ â†’ **ë³‘ëª© í™•ì¸**
- âœ… JSON/XML ì‘ë‹µ ì§€ì›
- â“ ìƒì„¸ ìŠ¤í™ ë¶ˆëª…í™• (ì‹¤ì œ í…ŒìŠ¤íŠ¸ í•„ìš”)

## ë„¤ì´ë²„ ì»¤ë¨¸ìŠ¤ API
- âœ… ê³µì‹ API ì¡´ì¬
- ğŸš¨ **Rate Limit: ì´ˆë‹¹ 2íšŒ (ì¹˜ëª…ì  ì œì•½!)**
- âš ï¸ OAuth 2.0 + IP í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ (ì„¤ì • ë³µì¡)
- âš ï¸ ì¹´í…Œê³ ë¦¬ë³„ í•„ìˆ˜ ì†ì„± ë‹¤ë¦„ (ì‚¬ì „ ë§¤í•‘ í•„ìš”)
- âš ï¸ ê¸ˆì§€ì–´ ìë™ ê²€ì¶œ (ë¸”ë™ë°•ìŠ¤)
- âœ… GitHub ê¸°ìˆ ì§€ì› ì±„ë„ ì¡´ì¬

## ê¸°ìˆ  ìŠ¤íƒ ê²°ì •
| í•­ëª© | ì„ íƒ | ì´ìœ  |
|------|------|------|
| ì–¸ì–´ | Python 3.11 | í•œê¸€ ì²˜ë¦¬ ìš°ìˆ˜, ë¹„ë™ê¸° I/O, íƒ€ì…íŒíŠ¸ |
| ì›¹ í”„ë ˆì„ì›Œí¬ | FastAPI | ë¹„ë™ê¸°, ìë™ ë¬¸ì„œí™”, Pydantic |
| íƒœìŠ¤í¬ í | Celery | ë³µì¡í•œ ì›Œí¬í”Œë¡œìš°, ìš°ì„ ìˆœìœ„ í |
| DB | PostgreSQL | íŠ¸ëœì­ì…˜, JSONB íƒ€ì… |
| ìºì‹œ | Redis | ë¹ ë¦„, ë©”ì‹œì§€ ë¸Œë¡œì»¤ ê²¸ìš© |

## ì£¼ìš” ë¦¬ìŠ¤í¬
1. ğŸš¨ ë„¤ì´ë²„ 2 TPS ì œì•½ â†’ **ë³‘ëª© ìµœìš°ì„  ëŒ€ì‘ í•„ìš”**
2. âš ï¸ ì˜µì…˜ êµ¬ì¡° ë³€í™˜ ë³µì¡ë„ â†’ **í”„ë¡œí† íƒ€ì… í•„ìˆ˜**
3. âš ï¸ ë°˜ë ¤ìœ¨ ì˜ˆì¸¡ ë¶ˆê°€ â†’ **ìˆ˜ë™ ê²€í†  í”„ë¡œì„¸ìŠ¤ í•„ìš”**
```

---

### 0-3. ì‹¤ì œ API í…ŒìŠ¤íŠ¸ (Proof of Concept)

#### ğŸ§ª **Postman/curlë¡œ ë¨¼ì € ì†ìœ¼ë¡œ í•´ë³´ê¸°**

```bash
# 1. ë„ë§¤ê¾¹ API í…ŒìŠ¤íŠ¸
curl -X GET "https://domeggook.com/ssl/api/" \
  -d "ver=4.1" \
  -d "mode=getItemList" \
  -d "aid=YOUR_API_KEY" \
  -d "market=dome" \
  -d "om=json" \
  | jq '.'

# 2. ì‘ë‹µ êµ¬ì¡° í™•ì¸
{
  "success": true,
  "data": {
    "items": [...],
    "total": 100
  }
}

# 3. ë„¤ì´ë²„ API í† í° ë°œê¸‰ í…ŒìŠ¤íŠ¸
curl -X POST "https://api.commerce.naver.com/oauth2/token" \
  -d "client_id=..." \
  -d "client_secret=..." \
  -d "grant_type=client_credentials"

# 4. ìƒí’ˆ ë“±ë¡ í…ŒìŠ¤íŠ¸ (ìˆ˜ë™ìœ¼ë¡œ JSON ì‘ì„±)
curl -X POST "https://api.commerce.naver.com/v2/products" \
  -H "Authorization: Bearer {token}" \
  -H "Content-Type: application/json" \
  -d '{
    "leafCategoryId": "50000123",
    "name": "í…ŒìŠ¤íŠ¸ ìƒí’ˆ",
    "statusType": "SALE",
    "salePrice": 10000
  }'
```

#### ğŸ“ **í…ŒìŠ¤íŠ¸ ê²°ê³¼ ê¸°ë¡**

```markdown
# API í…ŒìŠ¤íŠ¸ ê²°ê³¼

## ë„ë§¤ê¾¹ getItemList (2025-10-16)
- âœ… í˜¸ì¶œ ì„±ê³µ
- ì‘ë‹µ ì‹œê°„: 1.2ì´ˆ
- ì‹¤ì œ í•„ë“œ:
  - `item_id`: "DG123456"
  - `name`: "ìƒí’ˆëª…"
  - `price`: 10000 (ì •ìˆ˜)
  - `images`: ["url1", "url2"] (ë°°ì—´)
  - `options`: null (ì˜µì…˜ ì—†ëŠ” ìƒí’ˆì¼ ë•Œ)
- âš ï¸ EUC-KR ì¸ì½”ë”© ì•ˆ í•˜ë©´ í•œê¸€ ê¹¨ì§ í™•ì¸

## ë„¤ì´ë²„ ìƒí’ˆ ë“±ë¡ (2025-10-16)
- âœ… 1ì°¨ ì‹œë„: ì„±ê³µ
- âŒ 2ì°¨ ì‹œë„: 400 ì—ëŸ¬ "ì œì¡°ì¼ì í•„ìˆ˜"
  â†’ ì¹´í…Œê³ ë¦¬ë³„ í•„ìˆ˜ ì†ì„± í™•ì¸ í•„ìš”!
- âš ï¸ Rate Limit: 5íšŒ ì—°ì† í˜¸ì¶œ ì‹œ 6ë²ˆì§¸ 429 ì—ëŸ¬
  â†’ ì •í™•íˆ ì´ˆë‹¹ 2íšŒ ì œí•œ í™•ì¸
```

---

## Phase 1: ì•„í‚¤í…ì²˜ ì„¤ê³„

### 1-1. High-Level êµ¬ì¡° ë¨¼ì € ê·¸ë¦¬ê¸°

#### ğŸ“ **ë ˆì´ì–´ ì•„í‚¤í…ì²˜ ê²°ì •**

```
1. ì–´ë–¤ ë ˆì´ì–´ê°€ í•„ìš”í•œê°€?
   - Client Layer (UI/API)
   - Application Layer (FastAPI)
   - Queue Layer (Celery)
   - Service Layer (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)
   - Integration Layer (ì™¸ë¶€ API)
   - Data Layer (DB/Cache/Storage)

2. ê° ë ˆì´ì–´ì˜ ì±…ì„ì€?
   - Client: ì‚¬ìš©ì ìš”ì²­ ë°›ê¸°
   - Application: ìš”ì²­ ê²€ì¦, ì¡ ìƒì„±
   - Queue: ë¹„ë™ê¸° ì²˜ë¦¬, ì¬ì‹œë„
   - Service: ë°ì´í„° ë³€í™˜, ê²€ì¦
   - Integration: ì™¸ë¶€ API í˜¸ì¶œ
   - Data: ì˜ì†ì„±, ìºì‹±

3. ë ˆì´ì–´ ê°„ í†µì‹  ë°©ì‹ì€?
   - Client â†’ Application: HTTP REST
   - Application â†’ Queue: Celery task
   - Queue â†’ Service: í•¨ìˆ˜ í˜¸ì¶œ
   - Service â†’ Integration: async/await
   - Service â†’ Data: ORM/Redis client
```

---

### 1-2. ë°ì´í„° í”Œë¡œìš° ì„¤ê³„

#### ğŸ”„ **ETL íŒŒì´í”„ë¼ì¸ ìƒì„¸í™”**

```
[ì‚¬ìš©ì] "ì‹ ìƒí’ˆ 100ê°œ ë“±ë¡í•´ì¤˜"
   â†“
[FastAPI] POST /jobs
   - ìš”ì²­ ê²€ì¦
   - Job ë ˆì½”ë“œ ìƒì„± (DB)
   - Celery íƒœìŠ¤í¬ íì— ì¶”ê°€
   â†“
[Celery Worker - Extract]
   - ë„ë§¤ê¾¹ API í˜¸ì¶œ (100ê°œ)
   - Rate Limiter í†µê³¼
   - Redis ìºì‹œ ì²´í¬
   - DBì— ì›ë³¸ ë°ì´í„° ì €ì¥
   â†“
[Celery Worker - Transform]
   - HTML í´ë¦°ì—…
   - ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ/ë¦¬ì‚¬ì´ì¦ˆ
   - ì¹´í…Œê³ ë¦¬ ë§¤í•‘
   - ì˜µì…˜ ì •ê·œí™”
   - ê²€ì¦ (Validator)
   â†“
   ê²€ì¦ ì‹¤íŒ¨ â†’ [Manual Review Queue]
   ê²€ì¦ ì„±ê³µ â†“
[Celery Worker - Load]
   - Rate Limiter íšë“ (2 TPS)
   - ë„¤ì´ë²„ API í˜¸ì¶œ
   - ì„±ê³µ ì‹œ ë§¤í•‘ ì €ì¥
   - ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë¶„ì„ â†’ ì¬ì‹œë„ or Review Queue
   â†“
[ì‚¬ìš©ì] GET /jobs/{id}
   - ì§„í–‰ë¥  ì¡°íšŒ
   - ì—ëŸ¬ ëª©ë¡ í™•ì¸
```

#### ğŸ¨ **ìƒíƒœ ë‹¤ì´ì–´ê·¸ë¨**

```
PENDING â†’ VALIDATED â†’ UPLOADING â†’ REGISTERING â†’ COMPLETED
    â†“         â†“            â†“            â†“
 FAILED   MANUAL     RETRYING      MANUAL
         REVIEW                    REVIEW
```

---

### 1-3. ëª¨ë“ˆ êµ¬ì¡° ì„¤ê³„

#### ğŸ“ **ë””ë ‰í† ë¦¬ êµ¬ì¡° ê²°ì • ì›ì¹™**

```
1. ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬ (Separation of Concerns)
   - connectors/ : ì™¸ë¶€ APIë§Œ
   - services/ : ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ë§Œ
   - models/ : ë°ì´í„° êµ¬ì¡°ë§Œ

2. ìˆœí™˜ ì˜ì¡´ì„± ë°©ì§€
   - ìƒìœ„ ë ˆì´ì–´ â†’ í•˜ìœ„ ë ˆì´ì–´ (O)
   - í•˜ìœ„ ë ˆì´ì–´ â†’ ìƒìœ„ ë ˆì´ì–´ (X)

   ì˜ˆ: api/ â†’ services/ â†’ connectors/ (O)
       connectors/ â†’ api/ (X)

3. í…ŒìŠ¤íŠ¸ ê°€ëŠ¥ì„±
   - ê° ëª¨ë“ˆì´ ë…ë¦½ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥
   - Mock ê°ì²´ ì£¼ì… ìš©ì´

4. í™•ì¥ ê°€ëŠ¥ì„±
   - ìƒˆ ê³µê¸‰ì²˜ ì¶”ê°€ ì‹œ connectors/ì—ë§Œ íŒŒì¼ ì¶”ê°€
   - ìƒˆ ê²€ì¦ ë£° ì¶”ê°€ ì‹œ validators/ì—ë§Œ íŒŒì¼ ì¶”ê°€
```

#### ğŸ—‚ï¸ **ì‹¤ì œ êµ¬ì¡° ì˜ˆì‹œ**

```
app/
â”œâ”€â”€ api/              # ì—”ë“œí¬ì¸íŠ¸ ì •ì˜
â”‚   â””â”€â”€ jobs.py
â”œâ”€â”€ connectors/       # ì™¸ë¶€ ì‹œìŠ¤í…œ ì—°ë™
â”‚   â”œâ”€â”€ domeggook.py
â”‚   â””â”€â”€ naver.py
â”œâ”€â”€ services/         # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”‚   â”œâ”€â”€ product_service.py
â”‚   â””â”€â”€ mapping_service.py
â”œâ”€â”€ workers/          # ë°±ê·¸ë¼ìš´ë“œ ì‘ì—…
â”‚   â”œâ”€â”€ extract.py
â”‚   â”œâ”€â”€ transform.py
â”‚   â””â”€â”€ load.py
â”œâ”€â”€ models/           # ë°ì´í„° ëª¨ë¸
â”‚   â”œâ”€â”€ product.py
â”‚   â””â”€â”€ job.py
â””â”€â”€ utils/            # ê³µí†µ ìœ í‹¸ë¦¬í‹°
    â”œâ”€â”€ cache.py
    â””â”€â”€ logger.py
```

---

### 1-4. í•µì‹¬ ì»´í¬ë„ŒíŠ¸ ì„¤ê³„

#### âš™ï¸ **Rate Limiter ì„¤ê³„ ì‚¬ë¡€**

```python
# 1. ìš”êµ¬ì‚¬í•­ ì •ë¦¬
"""
- ë„¤ì´ë²„: ì´ˆë‹¹ 2íšŒ
- ë„ë§¤ê¾¹: ì´ˆë‹¹ 3íšŒ
- ë©€í‹° ì›Œì»¤ í™˜ê²½ (ë¶„ì‚°)
- Burst í—ˆìš© (ë‹¤ìŒ ì´ˆ ì„ ë¹Œë¦¼)
"""

# 2. ì•Œê³ ë¦¬ì¦˜ ì„ íƒ
"""
âœ… Token Bucket
- ì´ìœ : Burst ì§€ì›, êµ¬í˜„ ë‹¨ìˆœ
- ëŒ€ì•ˆ: Leaky Bucket (ë„ˆë¬´ strict)
"""

# 3. ì €ì¥ì†Œ ì„ íƒ
"""
âœ… Redis
- ì´ìœ : ë¶„ì‚° í™˜ê²½, INCR ì›ìì„±
- ëŒ€ì•ˆ: In-memory (ë‹¨ì¼ í”„ë¡œì„¸ìŠ¤ë§Œ ê°€ëŠ¥)
"""

# 4. ì¸í„°í˜ì´ìŠ¤ ì„¤ê³„
"""
class RateLimiter:
    async def acquire(timeout: Optional[float]) -> bool
    async def release()  # í•„ìš”ì‹œ
    async def get_remaining() -> int  # ë””ë²„ê¹…ìš©
"""

# 5. ì—£ì§€ ì¼€ì´ìŠ¤ ê³ ë ¤
"""
- Redis ì¥ì•  ì‹œ? â†’ fallback to in-memory
- ì‹œê° ë™ê¸°í™” ë¬¸ì œ? â†’ ì„œë²„ ì‹œê°„ ì‚¬ìš©
- Race condition? â†’ Lua scriptë¡œ ì›ìì„±
"""
```

---

### 1-5. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì„¤ê³„

#### ğŸ—„ï¸ **ERD ì‘ì„± ì›ì¹™**

```
1. ì •ê·œí™” (Normalization)
   - 1NF: ì›ìê°’ (ë°°ì—´ ì»¬ëŸ¼ ê¸ˆì§€)
   - 2NF: ë¶€ë¶„ í•¨ìˆ˜ ì¢…ì† ì œê±°
   - 3NF: ì´í–‰ í•¨ìˆ˜ ì¢…ì† ì œê±°

2. ì¸ë±ìŠ¤ ì „ëµ
   - WHERE ì ˆì— ìì£¼ ì‚¬ìš©ë˜ëŠ” ì»¬ëŸ¼
   - JOIN í‚¤
   - ì •ë ¬(ORDER BY) ì»¬ëŸ¼

3. JSONB ì‚¬ìš© ì‹œê¸°
   - ìŠ¤í‚¤ë§ˆê°€ ìì£¼ ë°”ë€ŒëŠ” ë°ì´í„° (metadata)
   - ì¿¼ë¦¬ ê±°ì˜ ì•ˆ í•˜ëŠ” ë°ì´í„° (raw API ì‘ë‹µ)

4. íƒ€ì„ìŠ¤íƒ¬í”„ í•„ìˆ˜
   - created_at, updated_at í•­ìƒ ì¶”ê°€
   - ë””ë²„ê¹…/ë¶„ì„ì— í•„ìˆ˜
```

#### ğŸ“Š **ì‹¤ì œ ìŠ¤í‚¤ë§ˆ ì˜ˆì‹œ**

```sql
-- 1. ìƒí’ˆ ì›ë³¸ ë°ì´í„° (ë„ë§¤ê¾¹)
CREATE TABLE products (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    domeggook_item_id VARCHAR(100) UNIQUE NOT NULL,
    name VARCHAR(500) NOT NULL,
    price INTEGER,
    category VARCHAR(200),
    raw_data JSONB NOT NULL,  -- ë„ë§¤ê¾¹ ì‘ë‹µ ì „ì²´ (ë³€í™˜ ì „)
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
CREATE INDEX idx_products_category ON products(category);
CREATE INDEX idx_products_domeggook_id ON products(domeggook_item_id);

-- 2. ë“±ë¡ ìƒíƒœ ì¶”ì 
CREATE TABLE product_registrations (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    product_id UUID REFERENCES products(id) ON DELETE CASCADE,
    state VARCHAR(50) NOT NULL CHECK (state IN (
        'PENDING', 'VALIDATED', 'UPLOADING',
        'REGISTERING', 'COMPLETED', 'RETRYING',
        'MANUAL_REVIEW', 'FAILED'
    )),
    naver_product_id VARCHAR(100),  -- ë“±ë¡ ì„±ê³µ í›„ ì±„ì›Œì§
    seller_product_code VARCHAR(100) UNIQUE,  -- SKU
    retry_count INTEGER DEFAULT 0,
    error_message TEXT,
    metadata JSONB,  -- ë³€í™˜ëœ ë°ì´í„°, ì´ë¯¸ì§€ URL ë“±
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
CREATE INDEX idx_registrations_state ON product_registrations(state);
CREATE INDEX idx_registrations_product ON product_registrations(product_id);

-- 3. ì¹´í…Œê³ ë¦¬ ë§¤í•‘
CREATE TABLE category_mappings (
    id SERIAL PRIMARY KEY,
    domeggook_category VARCHAR(200) NOT NULL,
    naver_leaf_category_id VARCHAR(50) NOT NULL,
    required_attributes JSONB,  -- {"ì œì¡°ì¼ì": "required", ...}
    confidence FLOAT DEFAULT 1.0,  -- ìë™ ë§¤í•‘ ì‹ ë¢°ë„
    is_active BOOLEAN DEFAULT TRUE,
    UNIQUE(domeggook_category, naver_leaf_category_id)
);
CREATE INDEX idx_category_dg ON category_mappings(domeggook_category);

-- 4. ì‘ì—… ì¶”ì 
CREATE TABLE jobs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    type VARCHAR(50) NOT NULL,  -- IMPORT, SYNC, etc.
    status VARCHAR(50) NOT NULL,  -- PENDING, RUNNING, COMPLETED, FAILED
    total_count INTEGER,
    success_count INTEGER DEFAULT 0,
    failed_count INTEGER DEFAULT 0,
    error_summary TEXT,
    created_at TIMESTAMP DEFAULT NOW(),
    completed_at TIMESTAMP
);
CREATE INDEX idx_jobs_status ON jobs(status);
CREATE INDEX idx_jobs_created ON jobs(created_at DESC);
```

---

## Phase 2: í”„ë¡œí† íƒ€ì… & ìŠ¤íŒŒì´í¬

### 2-1. í•µì‹¬ ë¦¬ìŠ¤í¬ë¶€í„° ê²€ì¦

#### ğŸ§ª **"ê°€ì¥ ì–´ë ¤ìš´ ë¶€ë¶„"ì„ ë¨¼ì € ë§Œë“¤ì–´ë³´ê¸°**

StoreBridge í”„ë¡œì íŠ¸ì˜ í•µì‹¬ ë¦¬ìŠ¤í¬:
1. âš ï¸ **ë„¤ì´ë²„ 2 TPS ì œì•½**
2. âš ï¸ **ì˜µì…˜ êµ¬ì¡° ë³€í™˜**
3. âš ï¸ **ì¹´í…Œê³ ë¦¬ ì†ì„± ë§¤í•‘**

**í”„ë¡œí† íƒ€ì… ëª©í‘œ:**
```
âœ… 1ê°œ ìƒí’ˆ End-to-End ì„±ê³µ
   - ë„ë§¤ê¾¹ì—ì„œ ì¡°íšŒ
   - ì˜µì…˜ ë³€í™˜
   - ë„¤ì´ë²„ì— ë“±ë¡
   - ì‹¤ì œ ìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´ì—ì„œ í™•ì¸

â±ï¸ ì‹œê°„ ì œí•œ: 3ì¼
ğŸ“¦ ì½”ë“œ í’ˆì§ˆ: ë‚®ì•„ë„ OK (ë‚˜ì¤‘ì— ë¦¬íŒ©í† ë§)
ğŸ¯ ëª©ì : "ì‹¤í˜„ ê°€ëŠ¥ì„±" ê²€ì¦
```

---

### 2-2. í”„ë¡œí† íƒ€ì… ì½”ë“œ ì˜ˆì‹œ

#### ğŸ› ï¸ **ë¹ ë¥´ê²Œ ë˜ì ¸ë³´ê¸° (Throwaway Prototype)**

```python
# prototype.py - í’ˆì§ˆ ë‚®ì•„ë„ OK, ì¼ë‹¨ ëŒì•„ê°€ê²Œ!

import requests
import json

# 1. ë„ë§¤ê¾¹ì—ì„œ ìƒí’ˆ 1ê°œ ì¡°íšŒ
def fetch_product():
    response = requests.get('https://domeggook.com/ssl/api/', params={
        'ver': '4.5',
        'mode': 'getItemView',
        'aid': 'YOUR_KEY',
        'market': 'dome',
        'om': 'json',
        'item_id': '12345'
    })
    return response.json()

# 2. ë„¤ì´ë²„ í˜•ì‹ìœ¼ë¡œ ë³€í™˜ (í•˜ë“œì½”ë”© OK)
def transform(product):
    return {
        'leafCategoryId': '50000123',  # ì¼ë‹¨ ê³ ì •ê°’
        'name': product['name'],
        'statusType': 'SALE',
        'salePrice': product['price'],
        'detailContent': '<div>' + product['description'] + '</div>',
        'images': [{'url': img} for img in product['images'][:10]],
        # ì˜µì…˜ì€ ì¼ë‹¨ ë‹¨ìˆœ ì¼€ì´ìŠ¤ë§Œ
        'options': None if not product.get('options') else [
            {
                'type': 'SIMPLE',
                'name': 'ìƒ‰ìƒ',
                'values': [{'name': opt, 'price': 0} for opt in product['options']]
            }
        ]
    }

# 3. ë„¤ì´ë²„ì— ë“±ë¡
def register_to_naver(product_data):
    # OAuth í† í° ë°œê¸‰
    token_response = requests.post('https://api.commerce.naver.com/oauth2/token', data={
        'client_id': 'YOUR_ID',
        'client_secret': 'YOUR_SECRET',
        'grant_type': 'client_credentials'
    })
    token = token_response.json()['access_token']

    # ìƒí’ˆ ë“±ë¡
    response = requests.post(
        'https://api.commerce.naver.com/v2/products',
        headers={'Authorization': f'Bearer {token}'},
        json=product_data
    )
    return response.json()

# 4. ì‹¤í–‰
if __name__ == '__main__':
    print("1. ë„ë§¤ê¾¹ì—ì„œ ìƒí’ˆ ì¡°íšŒ...")
    product = fetch_product()
    print(f"   âœ… {product['name']}")

    print("2. ë„¤ì´ë²„ í˜•ì‹ìœ¼ë¡œ ë³€í™˜...")
    naver_product = transform(product)
    print(f"   âœ… ë³€í™˜ ì™„ë£Œ")

    print("3. ë„¤ì´ë²„ì— ë“±ë¡...")
    result = register_to_naver(naver_product)
    print(f"   âœ… ë“±ë¡ ì™„ë£Œ: {result.get('productId')}")
```

#### ğŸ“ **í”„ë¡œí† íƒ€ì… ê²°ê³¼ ê¸°ë¡**

```markdown
# í”„ë¡œí† íƒ€ì… í…ŒìŠ¤íŠ¸ ê²°ê³¼ (2025-10-16)

## í…ŒìŠ¤íŠ¸ 1: ì˜µì…˜ ì—†ëŠ” ë‹¨ìˆœ ìƒí’ˆ
- âœ… ì„±ê³µ
- ì†Œìš” ì‹œê°„: 3.2ì´ˆ

## í…ŒìŠ¤íŠ¸ 2: ë‹¨ì¼ ì˜µì…˜ ìƒí’ˆ (ìƒ‰ìƒ)
- âœ… ì„±ê³µ
- ì†Œìš” ì‹œê°„: 4.1ì´ˆ

## í…ŒìŠ¤íŠ¸ 3: ì¡°í•© ì˜µì…˜ ìƒí’ˆ (ìƒ‰ìƒ Ã— ì‚¬ì´ì¦ˆ)
- âŒ ì‹¤íŒ¨: 400 ì—ëŸ¬ "Invalid option structure"
- ì›ì¸: ë„¤ì´ë²„ëŠ” COMBINATION íƒ€ì… í•„ìš”
- í•´ê²°: ì˜µì…˜ íŒŒì„œ ë¡œì§ ë³´ê°• í•„ìš”

## í…ŒìŠ¤íŠ¸ 4: ì¹´í…Œê³ ë¦¬ ì†ì„± ëˆ„ë½
- âŒ ì‹¤íŒ¨: 400 ì—ëŸ¬ "ì œì¡°ì¼ì í•„ìˆ˜"
- ì›ì¸: ë¦¬í”„ ì¹´í…Œê³ ë¦¬ë§ˆë‹¤ í•„ìˆ˜ ì†ì„± ë‹¤ë¦„
- í•´ê²°: ì¹´í…Œê³ ë¦¬ ì†ì„± ì¡°íšŒ API ë¨¼ì € í˜¸ì¶œ í•„ìš”

## ê²°ë¡ 
âœ… ê¸°ë³¸ í”Œë¡œìš° ì‹¤í˜„ ê°€ëŠ¥ì„± í™•ì¸
âš ï¸ ì˜µì…˜ ë³€í™˜ ë¡œì§ ë³µì¡ â†’ ë³„ë„ ëª¨ë“ˆë¡œ ë¶„ë¦¬
âš ï¸ ì¹´í…Œê³ ë¦¬ ì†ì„± ì‚¬ì „ ì²´í¬ í•„ìˆ˜
```

---

### 2-3. í”„ë¡œí† íƒ€ì…ì—ì„œ ë³¸ê²© ì½”ë“œë¡œ ì „í™˜

#### ğŸ”„ **ë¦¬íŒ©í† ë§ ì²´í¬ë¦¬ìŠ¤íŠ¸**

```
[ ] í•˜ë“œì½”ë”© ì œê±°
    - API í‚¤ â†’ í™˜ê²½ë³€ìˆ˜
    - URL â†’ ìƒìˆ˜
    - ì¹´í…Œê³ ë¦¬ ID â†’ DB/CSV

[ ] ì—ëŸ¬ ì²˜ë¦¬ ì¶”ê°€
    - try-except
    - ì¬ì‹œë„ ë¡œì§
    - ë¡œê¹…

[ ] í•¨ìˆ˜ ë¶„ë¦¬
    - í•œ í•¨ìˆ˜ = í•œ ê°€ì§€ ì—­í• 
    - ê¸´ í•¨ìˆ˜ ìª¼ê°œê¸°

[ ] íƒ€ì… íŒíŠ¸ ì¶”ê°€
    - def fetch_product() -> Dict[str, Any]

[ ] í…ŒìŠ¤íŠ¸ ì‘ì„±
    - ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
    - Mock ì‚¬ìš©

[ ] ë¬¸ì„œí™”
    - Docstring
    - README
```

---

## Phase 3: ë°˜ë³µ ê°œë°œ (Iterative Development)

### 3-1. ì‘ì€ ë‹¨ìœ„ë¡œ ìª¼ê°œê¸°

#### ğŸ“¦ **Feature ë‹¨ìœ„ ê°œë°œ**

```
âŒ ë‚˜ìœ ì˜ˆ: "ìƒí’ˆ ë“±ë¡ ê¸°ëŠ¥ ì™„ì„±" (ë„ˆë¬´ í¼, 3ì£¼ ì†Œìš”)

âœ… ì¢‹ì€ ì˜ˆ:
  Week 1:
    - [ ] ë„ë§¤ê¾¹ ì»¤ë„¥í„° (API í˜¸ì¶œë§Œ)
    - [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
    - [ ] 1ê°œ ìƒí’ˆ ì¡°íšŒ ì„±ê³µ

  Week 2:
    - [ ] ë„¤ì´ë²„ ì»¤ë„¥í„° (OAuth + 1ê°œ ë“±ë¡)
    - [ ] Rate Limiter
    - [ ] 1ê°œ ìƒí’ˆ ë“±ë¡ ì„±ê³µ

  Week 3:
    - [ ] Transform ë ˆì´ì–´ (HTML, ì´ë¯¸ì§€)
    - [ ] 10ê°œ ë°°ì¹˜ í…ŒìŠ¤íŠ¸

  Week 4:
    - [ ] Validator (ì¹´í…Œê³ ë¦¬, ê¸ˆì§€ì–´)
    - [ ] ìƒíƒœ ê¸°ê³„
    - [ ] ì—ëŸ¬ í•¸ë“¤ë§
```

---

### 3-2. TDD (Test-Driven Development) ì ìš©

#### ğŸ”´ **Red â†’ Green â†’ Refactor**

```python
# 1ë‹¨ê³„: ì‹¤íŒ¨í•˜ëŠ” í…ŒìŠ¤íŠ¸ ë¨¼ì € ì‘ì„± (Red)
def test_rate_limiter_allows_two_requests_per_second():
    limiter = RateLimiter(max_tps=2)

    # ì²« 2ê°œëŠ” ì„±ê³µ
    assert limiter.acquire() == True
    assert limiter.acquire() == True

    # 3ë²ˆì§¸ëŠ” ì‹¤íŒ¨
    assert limiter.acquire() == False

# ì‹¤í–‰: pytest â†’ FAILED (RateLimiterê°€ ì•„ì§ ì—†ìŒ)

# 2ë‹¨ê³„: ìµœì†Œí•œìœ¼ë¡œ í†µê³¼ì‹œí‚¤ê¸° (Green)
class RateLimiter:
    def __init__(self, max_tps):
        self.max_tps = max_tps
        self.count = 0

    def acquire(self):
        if self.count < self.max_tps:
            self.count += 1
            return True
        return False

# ì‹¤í–‰: pytest â†’ PASSED

# 3ë‹¨ê³„: ë¦¬íŒ©í† ë§ (Refactor)
# - Redis ì—°ë™ ì¶”ê°€
# - ì‹œê°„ ê¸°ë°˜ ë¦¬ì…‹ ì¶”ê°€
# - Lua scriptë¡œ ì›ìì„± ë³´ì¥
```

---

### 3-3. ì½”ë“œ ë¦¬ë·° ë¬¸í™”

#### ğŸ‘€ **ì…€í”„ ë¦¬ë·° ì²´í¬ë¦¬ìŠ¤íŠ¸**

```
[ ] ì½ê¸° ì‰¬ìš´ê°€?
    - ë³€ìˆ˜ëª…ì´ ëª…í™•í•œê°€?
    - í•¨ìˆ˜ê°€ ë„ˆë¬´ ê¸¸ì§€ ì•Šì€ê°€? (50ì¤„ ì´ë‚´)

[ ] í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•œê°€?
    - Mock ì£¼ì… ê°€ëŠ¥í•œê°€?
    - ë¶€ìˆ˜ íš¨ê³¼(side effect)ê°€ ëª…í™•í•œê°€?

[ ] ì—ëŸ¬ ì²˜ë¦¬í–ˆëŠ”ê°€?
    - ì™¸ë¶€ API ì‹¤íŒ¨ ì‹œ?
    - DB ì—°ê²° ëŠê¹€ ì‹œ?

[ ] ë¡œê·¸ ë‚¨ê²¼ëŠ”ê°€?
    - ë””ë²„ê¹… ê°€ëŠ¥í•œ ì •ë³´?
    - ë¯¼ê° ì •ë³´ (API í‚¤) ì œì™¸?

[ ] ë¬¸ì„œí™”í–ˆëŠ”ê°€?
    - Docstring?
    - ë³µì¡í•œ ë¡œì§ì— ì£¼ì„?

[ ] ì„±ëŠ¥ ê³ ë ¤í–ˆëŠ”ê°€?
    - N+1 ì¿¼ë¦¬?
    - ë¶ˆí•„ìš”í•œ ë°˜ë³µë¬¸?
```

---

## Phase 4: í…ŒìŠ¤íŠ¸ & í’ˆì§ˆ ê´€ë¦¬

### 4-1. í…ŒìŠ¤íŠ¸ í”¼ë¼ë¯¸ë“œ

```
       /\
      /  \  E2E (10%)
     /____\
    /      \  Integration (30%)
   /________\
  /          \ Unit (60%)
 /____________\
```

#### ğŸ§ª **ê° ë ˆë²¨ë³„ í…ŒìŠ¤íŠ¸**

```python
# 1. Unit Test (ë‹¨ìœ„ í…ŒìŠ¤íŠ¸)
def test_option_mapper_parses_combination():
    mapper = OptionMapper()
    raw = ['ë¸”ë™-S', 'ë¸”ë™-M', 'í™”ì´íŠ¸-S', 'í™”ì´íŠ¸-M']

    result = mapper.parse_combination(raw)

    assert result['type'] == 'COMBINATION'
    assert len(result['dimensions']) == 2
    assert result['dimensions'][0]['name'] == 'ìƒ‰ìƒ'

# 2. Integration Test (í†µí•© í…ŒìŠ¤íŠ¸)
@pytest.mark.integration
async def test_domeggook_client_fetches_product():
    client = DomeggookClient(api_key=os.getenv('DOMEGGOOK_API_KEY'))

    product = await client.get_item_view('12345')

    assert product['item_id'] == '12345'
    assert 'name' in product
    assert 'price' in product

# 3. E2E Test (ì¢…ë‹¨ê°„ í…ŒìŠ¤íŠ¸)
@pytest.mark.e2e
async def test_full_registration_flow():
    # 1. ìƒí’ˆ ìˆ˜ì§‘
    product = await domeggook_client.get_item_view('12345')

    # 2. ë³€í™˜
    transformed = await transform_service.transform(product)

    # 3. ê²€ì¦
    is_valid = await validator.validate(transformed)
    assert is_valid

    # 4. ë“±ë¡
    naver_product_id = await naver_client.create_product(transformed)
    assert naver_product_id is not None
```

---

### 4-2. ì™¸ë¶€ API í…ŒìŠ¤íŠ¸: VCR.py

#### ğŸ“¼ **API ì‘ë‹µ ë…¹í™”/ì¬ìƒ**

```python
import vcr

# 1. ì²« ì‹¤í–‰: ì‹¤ì œ API í˜¸ì¶œ & ë…¹í™”
@vcr.use_cassette('tests/fixtures/domeggook_item_12345.yaml')
def test_fetch_product():
    client = DomeggookClient(api_key='test_key')
    product = client.get_item_view('12345')

    assert product['name'] == 'í…ŒìŠ¤íŠ¸ ìƒí’ˆ'

# 2. ë‘ ë²ˆì§¸ ì‹¤í–‰ë¶€í„°: ë…¹í™”ëœ ì‘ë‹µ ì¬ìƒ (ì‹¤ì œ API í˜¸ì¶œ ì•ˆ í•¨!)
# â†’ ë¹ ë¦„, API ì¿¼í„° ì†Œë¹„ ì•ˆ í•¨, ì˜¤í”„ë¼ì¸ ê°€ëŠ¥
```

ë…¹í™” íŒŒì¼ (`tests/fixtures/domeggook_item_12345.yaml`):
```yaml
interactions:
- request:
    method: GET
    uri: https://domeggook.com/ssl/api/?ver=4.5&mode=getItemView&item_id=12345
  response:
    status: 200
    body:
      string: '{"success": true, "data": {"item_id": "12345", "name": "í…ŒìŠ¤íŠ¸ ìƒí’ˆ"}}'
```

---

### 4-3. ì •ì  ë¶„ì„ ë„êµ¬

#### ğŸ” **ìë™í™”ëœ ì½”ë“œ í’ˆì§ˆ ê²€ì‚¬**

```bash
# 1. Ruff (ë¦°í„° + í¬ë§¤í„°)
ruff check app/
ruff format app/

# 2. Mypy (íƒ€ì… ì²´í¬)
mypy app/ --strict

# 3. Bandit (ë³´ì•ˆ ì·¨ì•½ì )
bandit -r app/

# 4. Coverage (í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€)
pytest --cov=app --cov-report=html
```

#### âš™ï¸ **pre-commit í›… ì„¤ì •**

`.pre-commit-config.yaml`:
```yaml
repos:
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.1.0
    hooks:
      - id: ruff
      - id: ruff-format

  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.5.0
    hooks:
      - id: mypy
```

```bash
# ì„¤ì¹˜
pre-commit install

# ì´ì œ git commit ì‹œ ìë™ ì‹¤í–‰!
```

---

## Phase 5: ë°°í¬ & ìš´ì˜

### 5-1. ë°°í¬ ì „ ì²´í¬ë¦¬ìŠ¤íŠ¸

```
[ ] í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
    - .env íŒŒì¼ ì¤€ë¹„
    - í”„ë¡œë•ì…˜ API í‚¤ í™•ì¸

[ ] ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜
    - alembic upgrade head
    - ë°±ì—… í™•ì¸

[ ] ì‹œë“œ ë°ì´í„°
    - ì¹´í…Œê³ ë¦¬ ë§¤í•‘ í…Œì´ë¸”
    - ê¸ˆì§€ì–´ ëª©ë¡

[ ] ë³´ì•ˆ
    - API í‚¤ ë…¸ì¶œ í™•ì¸ (git secrets)
    - HTTPS ì„¤ì •
    - CORS ì„¤ì •

[ ] ëª¨ë‹ˆí„°ë§
    - Prometheus/Grafana ëŒ€ì‹œë³´ë“œ
    - Sentry ì•Œë¦¼ í…ŒìŠ¤íŠ¸
    - ë¡œê·¸ ìˆ˜ì§‘ í™•ì¸

[ ] ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
    - 100ê°œ ìƒí’ˆ ë“±ë¡ í…ŒìŠ¤íŠ¸
    - Rate Limit ì²´í¬
    - ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ í™•ì¸

[ ] ì¥ì•  ëŒ€ì‘ ê³„íš
    - Rollback ì ˆì°¨
    - ê¸´ê¸‰ ì—°ë½ì²˜
    - ë§¤ë‰´ì–¼ ì‘ì„±
```

---

### 5-2. ë‹¨ê³„ì  ë°°í¬ (Staged Rollout)

#### ğŸš¦ **ì ì§„ì ìœ¼ë¡œ í™•ëŒ€í•˜ê¸°**

```
Day 1: Canary (ì¹´ë‚˜ë¦¬ ë°°í¬)
  - 1ê°œ ìƒí’ˆë§Œ ë“±ë¡
  - ëª¨ë“  ë¡œê·¸ í™•ì¸
  - ì—ëŸ¬ ì—†ìœ¼ë©´ ë‹¤ìŒ ë‹¨ê³„

Day 3: Pilot (íŒŒì¼ëŸ¿)
  - 10ê°œ ìƒí’ˆ ë“±ë¡
  - ë°˜ë ¤ ì‚¬ìœ  ìˆ˜ì§‘
  - ë§¤í•‘ ë£° ë³´ê°•

Week 2: Beta
  - 100ê°œ ìƒí’ˆ ë“±ë¡
  - ì„±ëŠ¥ ë©”íŠ¸ë¦­ ìˆ˜ì§‘
  - ë³‘ëª© êµ¬ê°„ ìµœì í™”

Week 3: Full Rollout
  - 1,000ê°œ ìƒí’ˆ ë“±ë¡
  - 24/7 ëª¨ë‹ˆí„°ë§
  - On-call ëŒ€ê¸°
```

---

### 5-3. ëª¨ë‹ˆí„°ë§ & ì•Œë¦¼

#### ğŸ“Š **í•µì‹¬ ë©”íŠ¸ë¦­ ì •ì˜**

```python
from prometheus_client import Counter, Histogram, Gauge

# 1. ë¹„ì¦ˆë‹ˆìŠ¤ ë©”íŠ¸ë¦­
products_registered_total = Counter(
    'storebridge_products_registered_total',
    'Total products registered',
    ['status']  # success/failed
)

registration_success_rate = Gauge(
    'storebridge_registration_success_rate',
    'Success rate (last 1 hour)'
)

# 2. ì„±ëŠ¥ ë©”íŠ¸ë¦­
api_call_duration = Histogram(
    'storebridge_api_call_duration_seconds',
    'API call duration',
    ['api_name'],  # domeggook/naver
    buckets=[0.1, 0.5, 1, 2, 5, 10]
)

# 3. ì¸í”„ë¼ ë©”íŠ¸ë¦­
queue_depth = Gauge(
    'storebridge_queue_depth',
    'Current queue depth',
    ['queue_name']
)

rate_limit_remaining = Gauge(
    'storebridge_rate_limit_remaining',
    'Remaining rate limit',
    ['api_name']
)
```

#### ğŸš¨ **ì•Œë¦¼ ê·œì¹™**

```yaml
# alerting_rules.yml
groups:
  - name: storebridge
    interval: 1m
    rules:
      # ì„±ê³µë¥  70% ì´í•˜ â†’ ê¸´ê¸‰
      - alert: RegistrationSuccessRateLow
        expr: storebridge_registration_success_rate < 0.7
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "ë“±ë¡ ì„±ê³µë¥  70% ì´í•˜"

      # Rate Limit 90% ë„ë‹¬ â†’ ê²½ê³ 
      - alert: RateLimitAlmostExceeded
        expr: storebridge_rate_limit_remaining < 10
        for: 1m
        labels:
          severity: warning
        annotations:
          summary: "Rate Limit 90% ë„ë‹¬"

      # í ëŒ€ê¸° 1ì‹œê°„ ì´ˆê³¼ â†’ ê²½ê³ 
      - alert: QueueDepthHigh
        expr: storebridge_queue_depth > 1000
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "íì— 1000ê°œ ì´ìƒ ëŒ€ê¸° ì¤‘"
```

---

### 5-4. ì¥ì•  ëŒ€ì‘ (Incident Response)

#### ğŸ†˜ **Runbook (ëŒ€ì‘ ë§¤ë‰´ì–¼)**

```markdown
# Incident: ë„¤ì´ë²„ API 429 Too Many Requests

## ì¦ìƒ
- ìƒí’ˆ ë“±ë¡ ì‹¤íŒ¨ìœ¨ ê¸‰ì¦
- ë¡œê·¸ì— "429" ë‹¤ìˆ˜
- Rate Limit Exceeded ì•Œë¦¼

## ì›ì¸
1. ë‹¤ë¥¸ ì›Œì»¤ê°€ ë™ì‹œ í˜¸ì¶œ
2. Rate Limiter ë²„ê·¸
3. ë„¤ì´ë²„ ì¸¡ ì œí•œ ê°•í™”

## ì¦‰ì‹œ ì¡°ì¹˜
1. Celery ì›Œì»¤ ì¼ì‹œ ì¤‘ì§€
   ```bash
   docker-compose stop worker-normal worker-batch
   ```

2. Redis Rate Limiter í‚¤ í™•ì¸
   ```bash
   redis-cli KEYS "naver:ratelimit:*"
   redis-cli GET "naver:ratelimit:1697481234"
   ```

3. ìˆ˜ë™ìœ¼ë¡œ 1ê°œ ë“±ë¡ í…ŒìŠ¤íŠ¸
   ```bash
   curl -X POST http://localhost:8000/api/products/test
   ```

## ê·¼ë³¸ ì›ì¸ ë¶„ì„ (RCA)
- [ ] Rate Limiter ë¡œì§ ê²€í† 
- [ ] ë™ì‹œì„± í…ŒìŠ¤íŠ¸
- [ ] ë„¤ì´ë²„ ì¸¡ ë³€ê²½ ì‚¬í•­ í™•ì¸ (GitHub Discussions)

## ì¬ë°œ ë°©ì§€
- Rate Limiter ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì¶”ê°€
- ì•Œë¦¼ ì„ê³„ê°’ 70% â†’ 80%ë¡œ ì™„í™”
- Circuit Breaker íŒ¨í„´ ë„ì…
```

---

## ì‹¤ì „ íŒ & ì•ˆí‹°íŒ¨í„´

### âœ… **Best Practices**

#### 1. **ë¡œê·¸ë¥¼ êµ¬ì¡°í™”í•˜ë¼**
```python
# âŒ ë‚˜ìœ ì˜ˆ
print(f"ìƒí’ˆ ë“±ë¡: {product_id}")

# âœ… ì¢‹ì€ ì˜ˆ
logger.info(
    "Product registered",
    extra={
        'product_id': product_id,
        'naver_product_id': naver_id,
        'duration_ms': duration,
        'retry_count': retry_count
    }
)
# â†’ Grafana/Lokiì—ì„œ êµ¬ì¡°í™”ëœ ì¿¼ë¦¬ ê°€ëŠ¥
```

#### 2. **ì—ëŸ¬ ë©”ì‹œì§€ëŠ” ì•¡ì…˜ ê°€ëŠ¥í•˜ê²Œ**
```python
# âŒ ë‚˜ìœ ì˜ˆ
raise ValueError("Invalid data")

# âœ… ì¢‹ì€ ì˜ˆ
raise ValueError(
    f"Category {category_id} not found in mappings. "
    f"Please add to data/category_mappings.csv"
)
```

#### 3. **ì„¤ì •ì€ í™˜ê²½ë³€ìˆ˜ë¡œ, ë¹„ë°€ì€ Secrets Managerë¡œ**
```python
# config.py
from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    # ê³µê°œ ì„¤ì •
    max_retries: int = 3
    log_level: str = "INFO"

    # ë¹„ë°€ (í™˜ê²½ë³€ìˆ˜/AWS Secrets Managerì—ì„œ ë¡œë“œ)
    domeggook_api_key: str
    naver_client_secret: str

    class Config:
        env_file = ".env"
        env_prefix = "STOREBRIDGE_"

settings = Settings()
```

#### 4. **Graceful Degradation (ì ì§„ì  ì„±ëŠ¥ ì €í•˜)**
```python
# Redis ì¥ì•  ì‹œì—ë„ ì„œë¹„ìŠ¤ ìœ ì§€
async def get_cached_categories():
    try:
        return await redis.get('categories')
    except RedisConnectionError:
        logger.warning("Redis unavailable, fetching from DB")
        return await db.query(Category).all()
```

---

### âŒ **ì•ˆí‹°íŒ¨í„´ (í”¼í•´ì•¼ í•  ê²ƒ)**

#### 1. **God Object (ë§ŒëŠ¥ í´ë˜ìŠ¤)**
```python
# âŒ ë‚˜ìœ ì˜ˆ
class ProductManager:
    def fetch_from_domeggook(self): ...
    def transform(self): ...
    def validate(self): ...
    def upload_images(self): ...
    def register_to_naver(self): ...
    def send_email(self): ...
    # â†’ ë„ˆë¬´ ë§ì€ ì±…ì„!

# âœ… ì¢‹ì€ ì˜ˆ: ë‹¨ì¼ ì±…ì„ ì›ì¹™
class DomeggookClient: ...
class ProductTransformer: ...
class ProductValidator: ...
class ImageUploader: ...
class NaverClient: ...
```

#### 2. **Magic Numbers (ë§ˆë²• ìˆ«ì)**
```python
# âŒ ë‚˜ìœ ì˜ˆ
if retry_count > 3:
    await asyncio.sleep(300)

# âœ… ì¢‹ì€ ì˜ˆ
MAX_RETRIES = 3
RETRY_BACKOFF_SECONDS = 300

if retry_count > MAX_RETRIES:
    await asyncio.sleep(RETRY_BACKOFF_SECONDS)
```

#### 3. **Silent Failures (ì¡°ìš©í•œ ì‹¤íŒ¨)**
```python
# âŒ ë‚˜ìœ ì˜ˆ
try:
    await upload_image(img)
except Exception:
    pass  # ğŸ˜± ì—ëŸ¬ ë¬´ì‹œ!

# âœ… ì¢‹ì€ ì˜ˆ
try:
    await upload_image(img)
except Exception as e:
    logger.error(f"Image upload failed: {e}", exc_info=True)
    await error_queue.enqueue({
        'type': 'IMAGE_UPLOAD_FAILED',
        'image_url': img.url,
        'error': str(e)
    })
    raise  # ìƒìœ„ë¡œ ì „íŒŒ
```

#### 4. **Premature Optimization (ì„±ê¸‰í•œ ìµœì í™”)**
```python
# âŒ ë‚˜ìœ ì˜ˆ: ì•„ì§ ë³‘ëª©ë„ ì•„ë‹Œë° ë³µì¡í•˜ê²Œ
# (ë³‘ëª© í”„ë¡œíŒŒì¼ë§ë„ ì•ˆ í•´ë´¤ëŠ”ë° "ëŠë¦´ ê²ƒ ê°™ì•„ì„œ" ìµœì í™”)

# âœ… ì¢‹ì€ ì˜ˆ:
# 1. ë¨¼ì € ë‹¨ìˆœí•˜ê²Œ êµ¬í˜„
# 2. í”„ë¡œíŒŒì¼ë§ìœ¼ë¡œ ë³‘ëª© í™•ì¸
# 3. ë³‘ëª©ë§Œ ìµœì í™”
```

---

## í•™ìŠµ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ğŸ“ **ì´ ê°€ì´ë“œë¥¼ í†µí•´ ë°°ì›Œì•¼ í•  ê²ƒ**

#### Level 1: ê¸°ì´ˆ
- [ ] ìš”êµ¬ì‚¬í•­ì„ ëª…í™•í•œ ë¬¸ì„œë¡œ ì‘ì„±í•  ìˆ˜ ìˆë‹¤
- [ ] ì™¸ë¶€ API ë¬¸ì„œë¥¼ ì½ê³  Postmanìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆë‹¤
- [ ] ê¸°ìˆ  ìŠ¤íƒì„ ì„ íƒí•  ë•Œ ê·¼ê±°ë¥¼ ëŒˆ ìˆ˜ ìˆë‹¤
- [ ] í”„ë¡œí† íƒ€ì…ì„ ë¹ ë¥´ê²Œ ë§Œë“¤ ìˆ˜ ìˆë‹¤

#### Level 2: ì¤‘ê¸‰
- [ ] ë ˆì´ì–´ ì•„í‚¤í…ì²˜ë¥¼ ì„¤ê³„í•  ìˆ˜ ìˆë‹¤
- [ ] ERDë¥¼ ê·¸ë¦¬ê³  ì¸ë±ìŠ¤ë¥¼ ì„¤ê³„í•  ìˆ˜ ìˆë‹¤
- [ ] Rate Limiter ê°™ì€ í•µì‹¬ ì»´í¬ë„ŒíŠ¸ë¥¼ ì§ì ‘ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤
- [ ] ë‹¨ìœ„/í†µí•© í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë‹¤
- [ ] Docker Composeë¡œ ë¡œì»¬ í™˜ê²½ì„ êµ¬ì„±í•  ìˆ˜ ìˆë‹¤

#### Level 3: ê³ ê¸‰
- [ ] ìƒíƒœ ê¸°ê³„(State Machine)ë¥¼ ì„¤ê³„í•˜ê³  êµ¬í˜„í•  ìˆ˜ ìˆë‹¤
- [ ] ì—ëŸ¬ë¥¼ ë¶„ë¥˜í•˜ê³  ì¬ì‹œë„ ì „ëµì„ ì„¸ìš¸ ìˆ˜ ìˆë‹¤
- [ ] Prometheus/Grafanaë¡œ ëª¨ë‹ˆí„°ë§ì„ êµ¬ì¶•í•  ìˆ˜ ìˆë‹¤
- [ ] ì¥ì•  ëŒ€ì‘ ë§¤ë‰´ì–¼(Runbook)ì„ ì‘ì„±í•  ìˆ˜ ìˆë‹¤
- [ ] ë‹¨ê³„ì  ë°°í¬(Staged Rollout) ì „ëµì„ ìˆ˜ë¦½í•  ìˆ˜ ìˆë‹¤

---

## ğŸ“š ë” ê³µë¶€í•  ê²ƒë“¤

### ì¶”ì²œ ìë£Œ

#### ì•„í‚¤í…ì²˜
- ğŸ“˜ "Clean Architecture" - Robert C. Martin
- ğŸ“˜ "Domain-Driven Design" - Eric Evans
- ğŸ¥ [The Clean Code Talks](https://www.youtube.com/watch?v=4F72VULWFvc)

#### í…ŒìŠ¤íŠ¸
- ğŸ“˜ "Test Driven Development" - Kent Beck
- ğŸ”— [pytest ê³µì‹ ë¬¸ì„œ](https://docs.pytest.org/)

#### ë¶„ì‚° ì‹œìŠ¤í…œ
- ğŸ“˜ "Designing Data-Intensive Applications" - Martin Kleppmann
- ğŸ¥ [AWS re:Invent - Eventual Consistency](https://www.youtube.com/watch?v=9GFhGJcqBx8)

#### ìš´ì˜
- ğŸ“˜ "Site Reliability Engineering" - Google
- ğŸ”— [The Twelve-Factor App](https://12factor.net/)

---

## ğŸ¯ ë§ˆë¬´ë¦¬: ê°œë°œ í”„ë¡œì„¸ìŠ¤ì˜ í•µì‹¬

### ê¸°ì–µí•´ì•¼ í•  3ê°€ì§€

1. **"ë¹¨ë¦¬ ê°€ë ¤ë©´ ì²œì²œíˆ ê°€ë¼"**
   - ìš”êµ¬ì‚¬í•­ ë¶„ì„ â†’ ì•„í‚¤í…ì²˜ ì„¤ê³„ â†’ í”„ë¡œí† íƒ€ì…
   - ì²˜ìŒì— ì‹œê°„ ë“¤ì—¬ë„ ë‚˜ì¤‘ì— 10ë°° ì ˆì•½

2. **"ë¦¬ìŠ¤í¬ë¶€í„° ì œê±°í•˜ë¼"**
   - ê°€ì¥ ì–´ë ¤ìš´ ë¶€ë¶„ì„ ë¨¼ì € ê²€ì¦
   - í”„ë¡œí† íƒ€ì…ìœ¼ë¡œ ì‹¤í˜„ ê°€ëŠ¥ì„± í™•ì¸

3. **"ì‘ê²Œ ìì£¼ ë°°í¬í•˜ë¼"**
   - 1ê°œ â†’ 10ê°œ â†’ 100ê°œ â†’ 1,000ê°œ
   - ë‹¨ê³„ë§ˆë‹¤ í”¼ë“œë°± ìˆ˜ì§‘ & ê°œì„ 

---

**ì‘ì„±ì**: StoreBridge Team
**ìµœì¢… ìˆ˜ì •**: 2025-10-16
**ë²„ì „**: 1.0

---

## ë¶€ë¡: StoreBridge í”„ë¡œì íŠ¸ íƒ€ì„ë¼ì¸ ì˜ˆì‹œ

```
Week 0: ì¤€ë¹„
  Day 1-3: ìš”êµ¬ì‚¬í•­ ë¶„ì„, API ì¡°ì‚¬
  Day 4-5: Postman í…ŒìŠ¤íŠ¸, í”„ë¡œí† íƒ€ì…

Week 1-2: ê¸°ë°˜ êµ¬ì¶•
  - í”„ë¡œì íŠ¸ ì…‹ì—… (Docker, DB)
  - ë„ë§¤ê¾¹/ë„¤ì´ë²„ ì»¤ë„¥í„°
  - Rate Limiter
  - 1ê°œ ìƒí’ˆ E2E ì„±ê³µ

Week 3-4: íŒŒì´í”„ë¼ì¸
  - Transform ë ˆì´ì–´
  - Celery ì›Œì»¤
  - 10ê°œ ë°°ì¹˜ í…ŒìŠ¤íŠ¸

Week 5-6: ì•ˆì •í™”
  - Validator, ìƒíƒœ ê¸°ê³„
  - ì—ëŸ¬ í•¸ë“¤ë§
  - 100ê°œ ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸

Week 7-8: ìš´ì˜ ì¤€ë¹„
  - ëª¨ë‹ˆí„°ë§ (Grafana)
  - ì•Œë¦¼ (Sentry)
  - ë§¤ë‰´ì–¼ ì‘ì„±
  - íŒŒì¼ëŸ¿ (500ê°œ)

Week 9+: ìš´ì˜ & ê°œì„ 
  - ì‹¤ì „ íˆ¬ì…
  - ë°˜ë ¤ ì‚¬ìœ  ë¶„ì„
  - ë§¤í•‘ ë£° ë³´ê°•
  - ì„±ëŠ¥ ìµœì í™”
```

ì´ì œ ë‹¹ì‹ ë„ **ì‹¤ë¬´ ê°œë°œ í”„ë¡œì„¸ìŠ¤**ë¥¼ ë§ˆìŠ¤í„°í–ˆìŠµë‹ˆë‹¤! ğŸ‰
